/*
 * movement.c
 *
 *  Created on: Feb 6, 2025
 *      Author: gbrix
 */

#include "open_interface.h"
#include "movement.h"
#include "lcd.h"
#include "timer.h"

double move_forward (oi_t*sensor_data, double distance_mm){
    double sum = 0; // Tracks distance travelled
    oi_setWheels(300,300); // Move forward full speed

    while(sum < distance_mm) { // Checks if travelled 1 meter
        oi_update(sensor_data);
        sum += sensor_data -> distance; //pointer notation
        lcd_printf("%f", sum);
    }

    oi_setWheels(0,0); // stop
    timer_waitMillis(300);

    return sum;
}

double move_backward (oi_t*sensor_data, double distance_mm){
    double sum = 0; // Tracks distance travelled
    oi_setWheels(-300,-300); // Move forward full speed

    while(sum * -1 < distance_mm) { // Checks if travelled 1 meter
        oi_update(sensor_data);
        sum += sensor_data -> distance; //pointer notation
        lcd_printf("%f", sum);
    }

    oi_setWheels(0,0); // stop
    timer_waitMillis(300);

    return sum;
}

//Turn right a given degree
double turn_right(oi_t *sensor, double degrees) {
    oi_setWheels(-300, 300);
    double currDegree = 0;
    while(currDegree * -1 < degrees - 25){
        oi_update(sensor);
        currDegree += sensor -> angle; //pointer notation
        lcd_printf("%f", currDegree);
    }

    oi_setWheels(0,0); // stop
    timer_waitMillis(300);

    return degrees;
}

//Turn left a given degree
double turn_left(oi_t *sensor, double degrees) {
    oi_setWheels(300, -300);
    double currDegree = 0;
    while(currDegree < degrees - 25){
        oi_update(sensor);
        currDegree += sensor -> angle;
        lcd_printf("%f", currDegree);
    }
    oi_setWheels(0,0); // stop
    timer_waitMillis(300);

    return degrees;
}

double collison_backup(oi_t *sensor){
    oi_setWheeles(-300, -300);
    double sum = 0;

    return sum;
}


//move in a square
void drive_square(oi_t *sensor_data){
    move_forward(sensor_data, 500);
    turn_right(sensor_data, 90);
    move_forward(sensor_data, 500);
    turn_right(sensor_data, 90);
    move_forward(sensor_data, 500);
    turn_right(sensor_data, 90);
    move_forward(sensor_data, 500);
}

